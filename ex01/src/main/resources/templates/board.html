<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
	crossorigin="anonymous">
<style>
table {
	text-align: center;
}
</style>
<script>
window.addEventListener("DOMContentLoaded", function(){
	replyInsert();
});


/*-------------------------------------
등록 버튼 이벤트 지정
---------------------------------------*/	
const url = "/reply";
function replyInsert(){
	document.querySelector(".btnReplyInsert").addEventListener("click", function(){

		//파라미터 만들기
		const bno = replyForm.bno.value;
		const reply = replyForm.reply.value;
		const replyer = replyForm.replyer.value;
		const param = {reply, replyer, bno}
		
		//등록 요청
		fetch(url, {
			method:"post",
			headers: {
			      "Content-Type": "application/json",
			      // 'Content-Type': 'application/x-www-form-urlencoded',
			    },
			body : JSON.stringify(param), 
		})
		.then( result => result.text() )
		.then ( result => alert(result))
		// .then( result => replyList() )
	})
} 

/*-------------------------------------
댓글 조회 ajax 호출
---------------------------------------*/
function replyList(){
	const url = `/replies/pages/${bno}/1`
	fetch( url )
	.then( result => result.json() )
	.then( result => replyListCallback(result) )
}


/*-------------------------------------
댓글 조회 콜백
---------------------------------------*/
function replyListCallback(result){
	const replys = document.querySelector(".replys");
	replys.innerHTML = "";
	result.list.forEach(item => replys.insertAdjacentElement("beforeend", replyMake(item)) );
}

</script>
</head>
<body>
	<h1>사원 정보</h1>

	<table class="table table-striped table-bordered">
		<tr>
			<th>번호</th>
			<td th:text="${board.bno}"></td>
		</tr>
		<tr>
			<th>제목</th>
			<td th:text="${board.title}"></td>
		</tr>
		<tr>
			<th>작성자</th>
			<td th:text="${board.writer}"></td>
		</tr>
		<tr>
			<th>내용</th>
			<td th:text="${board.content}"></td>
		</tr>
		<tr>
			<th>등록일</th>
			<td th:text="${#dates.format(board.regdate,'yyyy-MM-dd')}"></td>
		</tr>
		<tr>
			<th>업뎃일</th>
			<td th:text="${#dates.format(board.updatedate,'yyyy-MM-dd')}"></td>
		</tr>
	</table>


	<!--  댓글 등록 -->
	<form name="replyForm">
		<div class="col-6">
			<input class="form-control" name="reply" placeholder="댓글">
		</div>
		<div class="col-3">
			<input class="form-control" name="replyer" placeholder="작성자">
		</div>
		<input name="bno" type="hidden" th:value="${board.bno}">
		<button class="btnReplyInsert" type="button">댓글 저장</button>
	</form>
	<!--  	<table class="table table-striped table-bordered">
		<tr>
			<th>댓글번호</th>
			<th>번호</th>
			<th>제목</th>
			<th>작성자</th> 
			<th>등록일</th>
			<th>수정일</th>
		</tr>
		<tr th:each="reply : ${reply}">
			<td th:text="${replyStat.index+1}"></td>
			<td th:text="${reply.rno}"></td>
			<td th:text="${reply.replyer}"></td>
			<td th:text="${reply.reply}"></td>
			<td th:text="${#dates.format(reply.replyDate,'yyyy-MM-dd')}"></td>
			<td th:text="${#dates.format(reply.updateDate,'yyyy-MM-dd')}"></td>
		</tr>
	</table>-->
	<button type="button" class="btn btn-success"
		onclick="location.href='/boardList'">홈으로</button>
</body>

</html>

