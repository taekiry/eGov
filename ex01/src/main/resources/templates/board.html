<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/Layout}">

<head>
  <meta charset="UTF-8">
  <title>게시글 상세</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
        crossorigin="anonymous">

<style>
/* 전체 레이아웃 */
body {
	background-color: #f8f9fa;
}

/* 제목 */
h1 {
	text-align: center;
	margin: 30px 0;
	font-weight: bold;
	color: #343a40;
}

/* 테이블 꾸미기 */
.table {
	width: 70%;
	margin: 0 auto 40px auto;
	background: white;
	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.table th {
	width: 20%;
	text-align: center;
	background-color: #f1f3f5;
}

/* 댓글 입력 폼 */
form[name="replyForm"] {
	width: 70%;
	margin: 0 auto;
	display: flex;
	align-items: center;
	gap: 10px;
}

form[name="replyForm"] input {
	flex: 1;
}

.btnReplyInsert {
	background-color: #198754;
	color: white;
	border: none;
	padding: 8px 15px;
	border-radius: 5px;
	transition: 0.2s;
}

.btnReplyInsert:hover {
	background-color: #157347;
}

/* 홈 버튼 */
.btn-home {
	display: block;
	width: 200px;
	margin: 30px auto;
}
.row{
	margin-bottom:10px;
	
}
</style>
<script>
window.addEventListener("DOMContentLoaded", function(){
	replyList();       //댓글조회
	//replyDelete();     //삭제 버튼 이벤트 지정
	//replyUpdateForm(); //수정폼 버튼 이벤트 지정
	//replyUpdate();     //수정 버튼 이벤트 지정
	//replyCancel();     //취소 버튼 이벤트 지정
	replyInsert();     //등록 버튼 이벤트 지정
	
});	


/*-------------------------------------
등록 버튼 이벤트 지정
---------------------------------------*/	
const url = "/reply";
function replyInsert(){
	document.querySelector(".btnReplyInsert").addEventListener("click", function(){

		//파라미터 만들기
		const bno = replyForm.bno.value;
		const reply = replyForm.reply.value;
		const replyer = replyForm.replyer.value;
		const param = {reply, replyer, bno}
		
		//등록 요청
		fetch(url, {
			method:"post",
			headers: {
			      "Content-Type": "application/json",
			      // 'Content-Type': 'application/x-www-form-urlencoded',
			    },
			body : JSON.stringify(param), 
		})
		.then( result => result.text() )
		.then ( result => alert(result))
		.then( result => replyList() )
	})
} 

/*-------------------------------------
댓글 조회 ajax 호출
---------------------------------------*/
function replyList(){
	const bno = replyForm.bno.value;
	const url = `/board/${bno}/reply`
	fetch( url )
	.then( result => result.json() )
	.then( result => replyListCallback(result) )
}


/*-------------------------------------
댓글 조회 콜백
---------------------------------------*/
function replyListCallback(result){
	const replys = document.querySelector("#replyList");
	replys.innerHTML = "";
	result.forEach(item => replys.insertAdjacentElement("beforeend", replyMake(item)) );
}


// 댓글 추가
function replyMake(item){
	let tag = document.createElement("div");
	tag.className = "row";
	tag.innerHTML = `
		<div class="col-lg-2">${item.rno}</div>
		<div class="col-lg-4">${item.replyer}</div>
		<div class="col-lg-4">${item.reply}</div>
		<div class="col-auto">
			<button data-rno="${item.rno}" type="button" class="btnReplyUpdate btn btn-warning">수정</button>
		</div>
		<div class="col-auto">
			<button data-rno="${item.rno}" type="button" class="btnReplyDelete btn btn-danger">삭제</button>
		</div>
	`;
    return tag;    
}

</script>
</head>
<body layout:fragment="content">
	<div class="card">
		<div class="card-header">게시글 정보</div>
		<div class="card-body">
			<table class="table table-bordered">
				<tr>
					<th>번호</th>
					<td th:text="${board.bno}"></td>
				</tr>
				<tr>
					<th>제목</th>
					<td th:text="${board.title}"></td>
				</tr>
				<tr>
					<th>작성자</th>
					<td th:text="${board.writer}"></td>
				</tr>
				<tr>
					<th>내용</th>
					<td colspan="2" th:text="${board.content}"></td>
				</tr>
				<tr>
					<th>등록일</th>
					<td th:text="${#dates.format(board.regdate,'yyyy-MM-dd')}"></td>
				</tr>
				<tr>
					<th>수정일</th>
					<td th:text="${#dates.format(board.updatedate,'yyyy-MM-dd')}"></td>
				</tr>
			</table>
		</div>
	</div>

	<div class="card">
		<div class="card-header">댓글 작성</div>
		<div class="card-body">
			<form name="replyForm" class="row g-2">
				<div class="col-md-7">
					<input class="form-control" name="reply" placeholder="댓글 입력">
				</div>
				<div class="col-md-3">
					<input class="form-control" name="replyer" placeholder="작성자">
				</div>
				<input name="bno" type="hidden" th:value="${board.bno}">
				<div class="col-auto	 d-grid">
					<button class="btn btn-success btnReplyInsert" type="button">저장</button>
				</div>
			</form>
		</div>
	</div>
	<div class="card">
		<div class="card-header">💬 댓글 목록</div>
		<div class="card-body">
			<div id="replyList" class="container text-center">
				<div class="row">
					<div class="col-lg-2">1</div>
					<div class="col-lg-4">홍길동</div>
					<div class="col-lg-4">댓글부분</div>
					<div class="col-auto">
						<button class="btnReplyUpdate btn btn-warning">수정</button>
					</div>
					<div class="col-auto">
						<button class="btnReplyDelete btn btn-danger">삭제</button>
					</div>
				</div>
			</div>
		</div>
	</div>
		<button type="button" class="btn-home btn btn-primary"
			onclick="location.href='/boardList'">홈으로</button>
</body>

</html>

