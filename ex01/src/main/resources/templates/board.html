<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/Layout}">

<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ìƒì„¸</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
        crossorigin="anonymous">

<style>
/* ì „ì²´ ë ˆì´ì•„ì›ƒ */
body {
	background-color: #f8f9fa;
}

/* ì œëª© */
h1 {
	text-align: center;
	margin: 30px 0;
	font-weight: bold;
	color: #343a40;
}

/* í…Œì´ë¸” ê¾¸ë¯¸ê¸° */
.table {
	width: 70%;
	margin: 0 auto 40px auto;
	background: white;
	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.table th {
	width: 20%;
	text-align: center;
	background-color: #f1f3f5;
}

/* ëŒ“ê¸€ ì…ë ¥ í¼ */
form[name="replyForm"] {
	width: 70%;
	margin: 0 auto;
	display: flex;
	align-items: center;
	gap: 10px;
}

form[name="replyForm"] input {
	flex: 1;
}

.btnReplyInsert {
	background-color: #198754;
	color: white;
	border: none;
	padding: 8px 15px;
	border-radius: 5px;
	transition: 0.2s;
}

.btnReplyInsert:hover {
	background-color: #157347;
}

/* í™ˆ ë²„íŠ¼ */
.btn-home {
	display: block;
	width: 200px;
	margin: 30px auto;
}
.row{
	margin-bottom:10px;
	
}
</style>
<script>
window.addEventListener("DOMContentLoaded", function(){
	replyList();       //ëŒ“ê¸€ì¡°íšŒ
	//replyDelete();     //ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
	//replyUpdateForm(); //ìˆ˜ì •í¼ ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
	//replyUpdate();     //ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
	//replyCancel();     //ì·¨ì†Œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
	replyInsert();     //ë“±ë¡ ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
	
});	


/*-------------------------------------
ë“±ë¡ ë²„íŠ¼ ì´ë²¤íŠ¸ ì§€ì •
---------------------------------------*/	
const url = "/reply";
function replyInsert(){
	document.querySelector(".btnReplyInsert").addEventListener("click", function(){

		//íŒŒë¼ë¯¸í„° ë§Œë“¤ê¸°
		const bno = replyForm.bno.value;
		const reply = replyForm.reply.value;
		const replyer = replyForm.replyer.value;
		const param = {reply, replyer, bno}
		
		//ë“±ë¡ ìš”ì²­
		fetch(url, {
			method:"post",
			headers: {
			      "Content-Type": "application/json",
			      // 'Content-Type': 'application/x-www-form-urlencoded',
			    },
			body : JSON.stringify(param), 
		})
		.then( result => result.text() )
		.then ( result => alert(result))
		.then( result => replyList() )
	})
} 

/*-------------------------------------
ëŒ“ê¸€ ì¡°íšŒ ajax í˜¸ì¶œ
---------------------------------------*/
function replyList(){
	const bno = replyForm.bno.value;
	const url = `/board/${bno}/reply`
	fetch( url )
	.then( result => result.json() )
	.then( result => replyListCallback(result) )
}


/*-------------------------------------
ëŒ“ê¸€ ì¡°íšŒ ì½œë°±
---------------------------------------*/
function replyListCallback(result){
	const replys = document.querySelector("#replyList");
	replys.innerHTML = "";
	result.forEach(item => replys.insertAdjacentElement("beforeend", replyMake(item)) );
}


// ëŒ“ê¸€ ì¶”ê°€
function replyMake(item){
	let tag = document.createElement("div");
	tag.className = "row";
	tag.innerHTML = `
		<div class="col-lg-2">${item.rno}</div>
		<div class="col-lg-4">${item.replyer}</div>
		<div class="col-lg-4">${item.reply}</div>
		<div class="col-auto">
			<button data-rno="${item.rno}" type="button" class="btnReplyUpdate btn btn-warning">ìˆ˜ì •</button>
		</div>
		<div class="col-auto">
			<button data-rno="${item.rno}" type="button" class="btnReplyDelete btn btn-danger">ì‚­ì œ</button>
		</div>
	`;
    return tag;    
}

</script>
</head>
<body layout:fragment="content">
	<div class="card">
		<div class="card-header">ê²Œì‹œê¸€ ì •ë³´</div>
		<div class="card-body">
			<table class="table table-bordered">
				<tr>
					<th>ë²ˆí˜¸</th>
					<td th:text="${board.bno}"></td>
				</tr>
				<tr>
					<th>ì œëª©</th>
					<td th:text="${board.title}"></td>
				</tr>
				<tr>
					<th>ì‘ì„±ì</th>
					<td th:text="${board.writer}"></td>
				</tr>
				<tr>
					<th>ë‚´ìš©</th>
					<td colspan="2" th:text="${board.content}"></td>
				</tr>
				<tr>
					<th>ë“±ë¡ì¼</th>
					<td th:text="${#dates.format(board.regdate,'yyyy-MM-dd')}"></td>
				</tr>
				<tr>
					<th>ìˆ˜ì •ì¼</th>
					<td th:text="${#dates.format(board.updatedate,'yyyy-MM-dd')}"></td>
				</tr>
			</table>
		</div>
	</div>

	<div class="card">
		<div class="card-header">ëŒ“ê¸€ ì‘ì„±</div>
		<div class="card-body">
			<form name="replyForm" class="row g-2">
				<div class="col-md-7">
					<input class="form-control" name="reply" placeholder="ëŒ“ê¸€ ì…ë ¥">
				</div>
				<div class="col-md-3">
					<input class="form-control" name="replyer" placeholder="ì‘ì„±ì">
				</div>
				<input name="bno" type="hidden" th:value="${board.bno}">
				<div class="col-auto	 d-grid">
					<button class="btn btn-success btnReplyInsert" type="button">ì €ì¥</button>
				</div>
			</form>
		</div>
	</div>
	<div class="card">
		<div class="card-header">ğŸ’¬ ëŒ“ê¸€ ëª©ë¡</div>
		<div class="card-body">
			<div id="replyList" class="container text-center">
				<div class="row">
					<div class="col-lg-2">1</div>
					<div class="col-lg-4">í™ê¸¸ë™</div>
					<div class="col-lg-4">ëŒ“ê¸€ë¶€ë¶„</div>
					<div class="col-auto">
						<button class="btnReplyUpdate btn btn-warning">ìˆ˜ì •</button>
					</div>
					<div class="col-auto">
						<button class="btnReplyDelete btn btn-danger">ì‚­ì œ</button>
					</div>
				</div>
			</div>
		</div>
	</div>
		<button type="button" class="btn-home btn btn-primary"
			onclick="location.href='/boardList'">í™ˆìœ¼ë¡œ</button>
</body>

</html>

